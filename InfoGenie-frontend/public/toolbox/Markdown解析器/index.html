<!doctype html>

<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#dff5d0" />
  <title>MarkdownËß£ÊûêÂô®</title>
  <!-- Markdown Ëß£Êûê‰∏éÂÆâÂÖ®Ê∏ÖÊ¥ó -->
  <script src="./marked.min.js"></script>
  <script src="./purify.min.js"></script>
  <style>
    :root {
      --bg-start: #e9f9e4;        /* Ê∑°ÁªøËâ≤ */
      --bg-end:   #f3ffdf;        /* Ê∑°ÈªÑÁªøËâ≤ */
      --card: rgba(255, 255, 255, 0.66);
      --card-border: rgba(108, 170, 92, 0.25);
      --text: #2b3a2e;
      --muted: #5c745a;
      --accent: #69b36d;
      --accent-2: #9adf76;
      --shadow: 0 10px 30px rgba(67, 125, 67, 0.15);
      --radius: 18px;
      --radius-sm: 12px;
      --maxw: min(96vw, 1600px);
    }* { box-sizing: border-box; }
html, body { height: 100%; }

body {
  margin: 0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "Noto Sans CJK SC", Arial, sans-serif;
  color: var(--text);
  background: linear-gradient(160deg, var(--bg-start) 0%, var(--bg-end) 100%);
  background-attachment: fixed;
}

header {
  position: sticky;
  top: 0;
  z-index: 5;
  backdrop-filter: saturate(120%) blur(8px);
  background: linear-gradient(160deg, rgba(233,249,228,0.75) 0%, rgba(243,255,223,0.75) 100%);
  border-bottom: 1px solid var(--card-border);
}

.wrap {
  max-width: var(--maxw);
  margin: 0 auto;
  padding: 14px 16px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.logo {
  width: 36px; height: 36px; border-radius: 50%;
  background: radial-gradient(circle at 30% 30%, var(--accent-2), var(--accent));
  box-shadow: var(--shadow);
  border: 1px solid var(--card-border);
  flex: 0 0 auto;
}

h1 { font-size: 18px; margin: 0; font-weight: 700; letter-spacing: .4px; }
.sub { color: var(--muted); font-size: 12px; }

main { max-width: var(--maxw); margin: 20px auto; padding: 0 16px 36px; }

.panel {
  background: var(--card);
  border: 1px solid var(--card-border);
  box-shadow: var(--shadow);
  border-radius: var(--radius);
  overflow: hidden;
}

.editor, .preview-box { padding: 14px; }

.label {
  font-size: 13px; font-weight: 600; color: var(--muted);
  display: flex; align-items: center; gap: 8px; margin-bottom: 10px;
}

textarea {
  width: 100%;
  min-height: 38vh; /* ÈÄÇÈÖçÊâãÊú∫Á´ñÂ±è */
  resize: vertical;
  padding: 14px 12px;
  background: rgba(255, 255, 255, 0.7);
  border: 1px solid var(--card-border);
  border-radius: var(--radius-sm);
  outline: none;
  font: 14px/1.55 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  color: #1f3024;
  transition: box-shadow .2s ease, border-color .2s ease;
}

textarea:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 4px rgba(105, 179, 109, 0.2);
  background: #fff;
}

.toolbar {
  display: flex;
  gap: 10px;
  margin-top: 10px;
  flex-wrap: wrap;
}

button {
  appearance: none; border: none; cursor: pointer;
  padding: 10px 14px; font-weight: 600; font-size: 14px;
  border-radius: 999px;
  background: linear-gradient(135deg, var(--accent-2), var(--accent));
  color: #083610; box-shadow: var(--shadow);
  transition: transform .04s ease, filter .2s ease;
}

button:active { transform: translateY(1px) scale(0.99); }
button.secondary { background: #ffffffb3; color: #2b3a2e; border: 1px solid var(--card-border); }

.grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 16px;
}

.markdown-body {
  padding: 12px 10px;
  background: rgba(255,255,255,0.6);
  border: 1px solid var(--card-border);
  border-radius: var(--radius-sm);
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}

/* Âü∫Á°Ä Markdown Ê†∑ÂºèÔºàÁÆÄÂåñÁâàÔºâ */
.markdown-body h1, .markdown-body h2, .markdown-body h3,
.markdown-body h4, .markdown-body h5, .markdown-body h6 {
  margin: 14px 0 8px; font-weight: 700; line-height: 1.25; color: #17361f;
}
.markdown-body h1 { font-size: 22px; }
.markdown-body h2 { font-size: 20px; }
.markdown-body h3 { font-size: 18px; }
.markdown-body p, .markdown-body ul, .markdown-body ol { margin: 10px 0; }
.markdown-body a { color: #0d6f3a; text-decoration: underline; }
.markdown-body blockquote { border-left: 4px solid var(--accent); padding: 8px 10px; margin: 10px 0; background: #f6fff0; }
.markdown-body code { background: #f1f7ea; padding: 2px 6px; border-radius: 6px; }
.markdown-body pre { background: #f1f7ea; padding: 10px; border-radius: 10px; overflow: auto; }
.markdown-body table { border-collapse: collapse; width: 100%; }
.markdown-body th, .markdown-body td { border: 1px solid #cfe6c8; padding: 8px; }
.markdown-body th { background: #e8f6df; }

/* ÂÖ®Â±èÈ¢ÑËßàË¶ÜÁõñÂ±Ç */
.overlay {
  position: fixed; inset: 0; z-index: 50;
  background: linear-gradient(160deg, rgba(233,249,228,0.96), rgba(243,255,223,0.96));
  display: none; flex-direction: column;
}
.overlay[aria-hidden="false"] { display: flex; }

.overlay-toolbar {
  display: flex; align-items: center; justify-content: space-between;
  padding: 10px 12px; gap: 10px;
  border-bottom: 1px solid var(--card-border);
  background: rgba(255,255,255,0.55);
  backdrop-filter: blur(8px) saturate(120%);
}

.overlay-title { font-weight: 700; color: #164926; font-size: 15px; }

.overlay-content {
  padding: 14px; overflow: auto; height: 100%;
}

.tip { font-size: 12px; color: var(--muted); margin-top: 6px; }

/* ÈÄÇÈÖçÊõ¥Â§ßÂ±èÂπïÊó∂ÁöÑÂ∏ÉÂ±Ä */
@media (min-width: 840px) {
  .grid { grid-template-columns: 1fr 1fr; }
  textarea { min-height: 55vh; }
}

  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1>MarkdownËß£ÊûêÂô®</h1>
      </div>
    </div>
  </header>  <main>
    <div class="grid">
      <section class="panel editor" aria-label="ÁºñËæëÂô®">
        <div class="label">Markdown ËæìÂÖ•</div>
        <textarea id="md-input" placeholder="Âú®Ê≠§ËæìÂÖ• Markdown ÊñáÊú¨"></textarea>
        <div class="toolbar">
          <button id="btn-preview">È¢ÑËßà</button>
          <button class="secondary" id="btn-clear" title="Ê∏ÖÁ©∫ËæìÂÖ•">Ê∏ÖÁ©∫</button>
        </div>
      </section><section class="panel preview-box" aria-label="È¢ÑËßà">
    <div class="label">ÂÆûÊó∂È¢ÑËßà</div>
    <article id="preview" class="markdown-body" aria-live="polite"></article>
  </section>
</div>

  </main>  <!-- ÂÖ®Â±èÈ¢ÑËßàË¶ÜÁõñÂ±Ç -->  <div id="overlay" class="overlay" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="overlay-toolbar">
      <div class="overlay-title">È¢ÑËßà</div>
      <div style="display:flex; gap:10px;">
        <button class="secondary" id="btn-exit">ÈÄÄÂá∫È¢ÑËßà</button>
      </div>
    </div>
    <div class="overlay-content">
      <article id="overlay-preview" class="markdown-body"></article>
    </div>
  </div>  <script>
    // Marked Âü∫Á°ÄÈÖçÁΩÆ
    marked.setOptions({
      gfm: true,
      breaks: true,
      headerIds: true,
      mangle: false
    });

    const $ = (sel) => document.querySelector(sel);
    const input = $('#md-input');
    const preview = $('#preview');
    const overlay = $('#overlay');
    const overlayPreview = $('#overlay-preview');
    const btnPreview = $('#btn-preview');
    const btnExit = $('#btn-exit');
    const btnClear = $('#btn-clear');

    const STORAGE_KEY = 'md-editor-content-v1';

    // Ê°åÈù¢Á´ØËá™Âä®Êâ©Â±ïËæìÂÖ•Ê°ÜÈ´òÂ∫¶
    const MQ_DESKTOP = window.matchMedia('(min-width: 840px)');
    function autoResizeTextarea(el) {
      el.style.height = 'auto';
      el.style.height = el.scrollHeight + 'px';
    }
    function applyTextareaMode() {
      if (MQ_DESKTOP.matches) {
        input.style.overflowY = 'hidden';
        input.style.resize = 'none';
        autoResizeTextarea(input);
      } else {
        input.style.overflowY = '';
        input.style.resize = '';
        input.style.height = '';
      }
    }
    MQ_DESKTOP.addEventListener('change', applyTextareaMode);

    function renderMarkdown(targetEl, srcText) {
      try {
        const html = marked.parse(srcText ?? '');
        // ‰ΩøÁî® DOMPurify ËøõË°åÂÆâÂÖ®Ê∏ÖÊ¥ó
        targetEl.innerHTML = DOMPurify.sanitize(html, { USE_PROFILES: { html: true } });
      } catch (e) {
        targetEl.textContent = 'Ëß£ÊûêÂá∫ÈîôÔºö' + e.message;
      }
    }

    function syncRender() {
      const text = input.value;
      // ‰øùÂ≠òÂà∞Êú¨Âú∞
      try { localStorage.setItem(STORAGE_KEY, text); } catch (e) {}
      renderMarkdown(preview, text);
      if (MQ_DESKTOP.matches) { autoResizeTextarea(input); }
    }

    // ÂàùÂßãËΩΩÂÖ•Ôºö‰ªéÊú¨Âú∞Â≠òÂÇ®ÊÅ¢Â§ç
    (function init() {
      let initial = '';
      try { initial = localStorage.getItem(STORAGE_KEY) || ''; } catch (e) {}
      if (!initial) {
        initial = `# üåø Ê¨¢Ëøé‰ΩøÁî®MarkdownËß£ÊûêÂô®\n\nÂú®Â∑¶‰æß/‰∏äÊñπËæìÂÖ• MarkdownÔºåÂè≥‰æß/‰∏ãÊñπ‰ºö **ÂÆûÊó∂È¢ÑËßà**„ÄÇ\n\n- ÊîØÊåÅ GFM„ÄÅËá™Âä®Êç¢Ë°å„ÄÅ‰ª£Á†ÅÂùó\n- ÁÇπÂáªÂè≥‰∏äÊñπÁöÑ **ÂÖ®Â±èÈ¢ÑËßà** ÊåâÈíÆ\n- ÂÜÖÂÆπ‰ºö‰øùÂ≠òÂú®Êú¨Âú∞ÊµèËßàÂô®‰∏≠\n\n> Â∞èÊèêÁ§∫ÔºöÊîØÊåÅË°®Ê†º„ÄÅÂºïÁî®„ÄÅÈìæÊé•Á≠âÂ∏∏ËßÅËØ≠Ê≥ï~\n\n| ÂäüËÉΩ | Áä∂ÊÄÅ |\n| ---- | ---- |\n| ÂÆûÊó∂È¢ÑËßà | ‚úÖ |\n| ÂÖ®Â±èÈ¢ÑËßà | ‚úÖ |\n| Êú¨Âú∞‰øùÂ≠ò | ‚úÖ |\n`;
      }
      input.value = initial;
      syncRender();
      applyTextareaMode();
    })();

    // ËæìÂÖ•ÂÆûÊó∂Ê∏≤Êüì
    input.addEventListener('input', syncRender);

    // Ê∏ÖÁ©∫
    btnClear.addEventListener('click', () => {
      input.value = '';
      syncRender();
      input.focus();
    });

    // ÊâìÂºÄÂÖ®Â±èÈ¢ÑËßà
    btnPreview.addEventListener('click', async () => {
      overlay.setAttribute('aria-hidden', 'false');
      overlayPreview.innerHTML = preview.innerHTML;
      // Â∞ùËØïË∞ÉÁî®ÂéüÁîüÂÖ®Â±è APIÔºàÂÖºÂÆπÊÄßÈôçÁ∫ßÂà∞Ë¶ÜÁõñÂ±ÇÔºâ
      try {
        if (!document.fullscreenElement && overlay.requestFullscreen) {
          await overlay.requestFullscreen();
        }
      } catch (e) {
        // ÂøΩÁï•ÈîôËØØÔºåË¶ÜÁõñÂ±ÇÂ∑≤ÊòæÁ§∫
      }
    });

    // ÈÄÄÂá∫ÂÖ®Â±èÈ¢ÑËßà
    function exitOverlay() {
      overlay.setAttribute('aria-hidden', 'true');
      if (document.fullscreenElement && document.exitFullscreen) {
        document.exitFullscreen().catch(() => {});
      }
    }

    btnExit.addEventListener('click', exitOverlay);

    // Esc ÈîÆÈÄÄÂá∫
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && overlay.getAttribute('aria-hidden') === 'false') {
        exitOverlay();
      }
    });

    // ÂΩìÂÜÖÂÆπÂèòÂåñÊó∂ÔºåËã•Â§Ñ‰∫éÂÖ®Â±èÈ¢ÑËßàÔºåÂàôÂêåÊ≠•ÂÜÖÂÆπ
    const obs = new MutationObserver(() => {
      if (overlay.getAttribute('aria-hidden') === 'false') {
        overlayPreview.innerHTML = preview.innerHTML;
      }
    });
    obs.observe(preview, { childList: true, subtree: true });
  </script></body>
</html>